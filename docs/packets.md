# 数据包格式

## 基本格式

```
0 +--------------+
  |    包类型    | uint16_t
2 +--------------+
  | 客户端标识符 | uint32_t
6 +--------------+
  | 数据区域长度 | uint32_t
10+--------------+
  |    数据区    |
  \______________/
```

## 可能的包类型

+ 0x00 握手
+ 0x01 心跳
+ 0x02 动作
+ 0x03 说话
+ 0xff 断开

假定数据包为小端传递。

## 握手

握手包是客户端与服务器建立通信时发送的第一个数据包。
服务器收到握手包后，应开始握手流程。

一个典型的握手流程：

```
client:
 00 00                               包类型：握手
 ff ff ff ff                         待分配标识符
 00 09 00 00                         数据区长度：9（可变）
 'u' 's' 'e' 'r' 'n' 'a' 'm' 'e' 00  以 0 结尾的用户名（可变）

server:
 00 00                               包类型：握手
 __ __ __ __                         服务器向客户端分配标识符
 ?? ?? ?? ??                         数据区长度未知，由服务器运算
 01                                  0x01 - 请求密码
 ** ** ** ** ** ** ** ..             服务器公钥

client:
 00 00                               包类型：握手
 __ __ __ __                         由服务器分配的标识符
 ?? ?? ?? ??                         长度未知，由客户端运算
 ## ## ## ## ## ## ## ..             加密的密码

server:
 00 00                               包类型：握手
 __ __ __ __                         由服务器分配的标识符
 00 01 00 00                         数据区长度：1
 00                                  0x00 - 登录成功，握手完成

如果验证失败，则

server:
 00 00                               包类型：握手
 ff ff ff ff                         空标识符
 00 01 00 00                         数据区长度：1
 ff                                  0xff - 验证失败，重新握手
```

## 心跳

心跳包由客户端向服务器以每 2 秒一次发送。最长间隔不应超过 5 秒。

如果心跳包没有回应，客户端应以每秒 1 次继续尝试最多 3 次，再断开连接。

一个典型的心跳：

```
client:
 01 00        包类型：心跳
 __ __ __ __  握手时分配的标识符
 00 00 00 00  没有数据

server:
 01 00        包类型：心跳
 __ __ __ __  由客户端发送的标识符
 00 01 00 00  数据区长度：1
 01           0x01 - 已刷新
```
